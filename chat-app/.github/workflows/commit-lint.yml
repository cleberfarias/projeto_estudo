name: Commit Message Check

on:
  pull_request:
    branches: [main]

jobs:
  check-commits:
    name: Validate Commit Messages
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check Conventional Commits
        run: |
          echo "üîç Verificando mensagens de commit..."
          
          # Pega todos os commits do PR
          COMMITS=$(git log --format=%s origin/main..HEAD)
          
          # Padr√£o de conventional commits
          PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"
          
          INVALID_COMMITS=""
          
          while IFS= read -r commit; do
            if ! echo "$commit" | grep -qE "$PATTERN"; then
              INVALID_COMMITS="${INVALID_COMMITS}\n  - $commit"
            fi
          done <<< "$COMMITS"
          
          if [ ! -z "$INVALID_COMMITS" ]; then
            echo "‚ùå Commits que n√£o seguem Conventional Commits:"
            echo -e "$INVALID_COMMITS"
            echo ""
            echo "üìñ Formato esperado:"
            echo "   tipo(escopo opcional): descri√ß√£o"
            echo ""
            echo "   Tipos v√°lidos: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
            echo ""
            echo "   Exemplos:"
            echo "   - feat: adiciona bot√£o de upload"
            echo "   - fix(chat): corrige scroll autom√°tico"
            echo "   - docs: atualiza README"
            exit 1
          fi
          
          echo "‚úÖ Todas as mensagens de commit est√£o corretas"
